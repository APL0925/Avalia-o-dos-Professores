<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o de Professores</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .comment-box { border: 1px solid #ccc; padding: 10px; margin: 10px 0; position: relative; }
        .delete-btn { position: absolute; top: 5px; right: 5px; background: red; color: white; border: none; cursor: pointer; padding: 5px; display: none; }
    </style>
</head>
<body>
    <h1>Avalia√ß√£o de Professores</h1>
    
    <label for="professor">Escolha um professor:</label>
    <select id="professor">
        <option>Andr√©</option>
        <option>D√©bora</option>
        <option>V√≠tor</option>
        <option>Silv√¢nia</option>
        <option>Oliveira Santos</option>
        <option>Ribamar</option>
        <option>Kelma</option>
        <option>J√∫nior</option>
        <option>Lorenzo</option>
        <option>Onilma</option>
        <option>Izaias</option>
        <option>Alberes</option>
    </select>
    
    <br><br>
    
    <label><input type="checkbox" id="identificado"> Deseja ser identificado?</label>
    <br>
    <input type="text" id="nome" placeholder="Seu nome" style="display:none;">
    <br><br>
    
    <textarea id="comentario" rows="4" cols="50" placeholder="Escreva sua opini√£o..."></textarea>
    <br>
    <button onclick="adicionarComentario()">Enviar Coment√°rio</button>
    
    <h2>Coment√°rios:</h2>
    <div id="comments"></div>

    <script>
        // üî• Configura√ß√£o do Firebase (substitua com suas credenciais)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            databaseURL: "SEU_DATABASE_URL",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // üî• Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const CRIADOR_SITE = "Admin"; // Nome do admin

        document.getElementById("identificado").addEventListener("change", function() {
            document.getElementById("nome").style.display = this.checked ? "block" : "none";
        });

        function adicionarComentario() {
            let professor = document.getElementById("professor").value;
            let identificado = document.getElementById("identificado").checked;
            let nome = identificado ? document.getElementById("nome").value : "An√¥nimo";
            let comentario = document.getElementById("comentario").value;

            if (comentario.trim() === "") {
                alert("Por favor, escreva um coment√°rio.");
                return;
            }

            let novoComentario = {
                nome: nome,
                professor: professor,
                comentario: comentario,
                timestamp: Date.now() // Para ordenar os coment√°rios depois
            };

            // üî• Envia para Firebase
            db.ref("comentarios").push(novoComentario);
            document.getElementById("comentario").value = "";
        }

        function carregarComentarios() {
            let commentsDiv = document.getElementById("comments");
            commentsDiv.innerHTML = "";

            db.ref("comentarios").on("value", function(snapshot) {
                commentsDiv.innerHTML = "";
                snapshot.forEach(function(childSnapshot) {
                    let key = childSnapshot.key; // ID do coment√°rio
                    let c = childSnapshot.val();

                    let div = document.createElement("div");
                    div.className = "comment-box";
                    div.innerHTML = `<strong>${c.professor} - ${c.nome}</strong><br>${c.comentario}`;

                    let botaoExcluir = document.createElement("button");
                    botaoExcluir.className = "delete-btn";
                    botaoExcluir.innerText = "Excluir";
                    botaoExcluir.onclick = function() { excluirComentario(key); };

                    let usuarioAtual = localStorage.getItem("usuarioAtual") || "An√¥nimo";

                    // Exibe o bot√£o se o usu√°rio for o dono ou o admin
                    if (usuarioAtual === c.nome || usuarioAtual === CRIADOR_SITE) {
                        botaoExcluir.style.display = "block";
                    }

                    div.appendChild(botaoExcluir);
                    commentsDiv.appendChild(div);
                });
            });
        }

        function excluirComentario(id) {
            db.ref("comentarios/" + id).remove();
        }

        window.onload = carregarComentarios;
    </script>
</body>
</html>
